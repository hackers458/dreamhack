🧩 Reverse Engineering Challenge: bitvm

# 📖 문제 개요
- 문제 이름: bitvm
- 출처: 드림핵
- 키워드: 가상 머신
- 설명: 가상 머신이 있으며 해당 커맨드를 읽고 작동 방식을 이해한 뒤 입력 플래그를 얻는 문제

# 🛠️ 사용 도구
- IDA / Ghidra → 정적 분석
- PyCharm → 코드 분석

# 🚀 풀이 방법
- 가상 머신의 작동 방식을 이해한 뒤 각 인덱스에 해당하는 값을 추출하면 된다.

# 📁 파일 구성
- chall : 가상 머신
- command : 가상 머신을 실행할 command

# 🔍 파일 동작 원리
<img width="395" height="343" alt="화면 캡처 2026-01-27 181912" src="https://github.com/user-attachments/assets/1b529717-3665-4786-8a26-2e41681eb4d1" />

해당 사진을 보면 첫번째 줄에는 조건이 맞으면 종료를 안하게 된다. 즉 실행할때 ./chall command_file로 실행해야 된다는 법

<img width="869" height="810" alt="화면 캡처 2026-01-27 183736" src="https://github.com/user-attachments/assets/46f73229-9218-4c7e-861a-57d2d1711ccf" />

그리곤 이 함수가 진짜 가상 머신 기능인데. 해당 기능을 요약하기 전에 v3[0]의 크기가 QWORD이다. 즉 8바이트이며 
1. command file에 값을 하나 읽어온다.
2. 그 값에 따른 명령어(#,$,%,&,'.....)를 실행한다
   각각 케이스 별로 기능은 출력, 입력, 8바이트 공간 중 대입, and,or,xor 연산,내가입력한 문자열을 스택에 넣은 상태에서 탑에서 뽑기 등
# 🧠 접근 방법
<img width="626" height="1019" alt="화면 캡처 2026-01-27 184641" src="https://github.com/user-attachments/assets/c87c8cf4-6524-427d-b3ed-7d7533559529" />

해당 사진을 보면 
23 01 F3 23 02 71 23 03 FF 28 25 04 00 01 27 05 02 04 26 07 05 07 26 04 00 01 27 05 03 04 26 07 05 07를 발췌해보았다.
#ó#q#ÿ(%�'&&�'&로 hxd에서 볼 수 있다.
즉 #이 무조건 3개이므로 각 8바이트 공간 중 # 다음에 해당하는 숫자에 해당하는 인덱스에 넣기,
(은 내가 입력한 문자열의 끝부분에서 하나 뽑고 스택 포인터 줄이기
그 다음 % ' & & ' &으로 연산하기이다. 즉 다음 # 3개를 만날때 전까지가 내 문자열 중 하나를 검사하는 코드이다.(덩어리를 생각하면 된다)

자 잘 생각해보면 이걸 역연산할 것 같이 생겼지만 10분동안 코드를 짜보았더니 역연산이 안된다. command의 맨 마지막으로 갔을때부터 반대로 수행해본다고 하면 예를들어 8바이트 공간에 인덱스 2 4 6을 초기화 한 뒤 연산 수행을 인덱스 2 5 7에 해당하는
값을 사용한다고 생각해보자, 그러면 2 4 6만 아는 상태에서 5 7은 어디서 구하는가? 바로 그 전 덩이리나 전전 덩어리에 잇을 것이다.

그렇다면 어떻게 접근해야 하는가?
사실 이 코드는 각 문자열 하나하나 검사하는게 아닌 각 문자열이 상호작용을 한다. 즉 이 command의 총 연산이 0이 나와야 하는것이기에 현재의 값이 다음에 쓰이는 상태에 사용하기 좋은 z3를 사용하면 된다.
(첫번째 수행을 통한 변수가 다음 수행을 할때 영향을 끼칠때)
# 📚 공부한 내용
- Z3에서 현재의 값이 다음에 쓰이는 상태에 영향을 줄 때 코드를 어떻게 써야하는지 배웠다.
- 가상머신에 대해 완전히 알게되었다.
