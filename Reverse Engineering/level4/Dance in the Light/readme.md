# 🧩 Reverse Engineering Challenge: Dance in the Light

## 📖 문제 개요
- **문제 이름**: Dance in the Light  
- **출처**: 드림핵  
- **키워드**: mp3 파일구조
- **설명**: mp3 파일 구조를 파악하고 변조된 곳을 찾아 원상복구하기

---

## 🛠️ 사용 도구
- **IDA**: 정적 분석  
- **GDB**: 동적 분석  
- **PyCharm**: 코드 작성  

---

## 🚀 풀이 방법
- mp3의 바이너리중 정상적인것과 변조된것 모두를 찾아 바이너리를 연결하여 플래그를 완성

---

## 📁 파일 구성
- **main** : 플래그를 입력하면 mp3를 변조하여 새로운 mp3를 만드는 프로그램
- **output.mp3** : 변조된 mp3로 이걸 이용하여 변조전 데이터를 구해야함.

---

## 🔍 파일 동작 원리

| 단계 | 이미지 | 설명 |
|------|--------|------|
| Step 1 | <img width="756" height="753" alt="화면 캡처 2026-02-14 210716" src="https://github.com/user-attachments/assets/128bb4a2-a6cc-46d8-a302-8b42d397c74c" />| 해당 코드를 보면 프로그램 사용법은 인자에 각각 원래 mp3,저장할mp3이름,플래그이며 플래그를 입력하면, 예를들어 Abcd를 입력하면 A부터 2진수로 변환하여 65 -> 0100 0001로 오른쪽부터 넘긴다.  |
| Step 2 | <img width="527" height="872" alt="화면 캡처 2026-02-14 211055" src="https://github.com/user-attachments/assets/0f292d1c-d7c9-49e7-a13a-c25e0acdc585" />| 그 다음에 이 함수는 아까 넘겨준걸 받는데 1번에는 프레임에서 맨 앞 4바이트(헤더)를 가지고무결성 검사, 2번에는 프레임의 길이를 구한다. 여기서의 프레임은 음악이 시작하고 끝나는 최소 단위이다.  |
| Step 3 | <img width="569" height="617" alt="화면 캡처 2026-02-14 211232" src="https://github.com/user-attachments/assets/3b2f5a0a-91d4-409c-a7b9-4282622916e4" />| 그 후 3번에서는 헤더에서 다음 프레임전까지의 바이너리를 xor한뒤 여러 연산을 거쳐 내가 입력한 문자의 2진수와 다른지 비교를 한다. 만약 다르면 or 1를 한다.|

---

## 🧠 접근 방법

| 이미지 | 설명 |
| --- | --- |
| <img width="604" height="936" alt="화면 캡처 2026-02-14 211601" src="https://github.com/user-attachments/assets/341890a0-7cd3-4098-804d-2be5becb82aa" />| 사진처럼 이렇게 프레임이 있으며 41과 43이 있는데 이는 변조된 값이다, 즉 40과 42는 변조되지 않았기에 헤더 다음의 값부터 다음 프레임전까지의 xor+ 복잡한 연산 결과는 40과42는 그대로, 41과43은 반대로 구해주면 된다.|

---

## 😪 막힌 부분
- 41과 43이 길이인줄 알았다.. 사실 길이 구하는 연산은 확인했는데 그냥 41과 43이 길이처럼 생겨서 해보니까 잘못된 플래그가 나왔었다.

---

## 📚 공부한 내용
- mp3 구조에 대해 알게 되었다.
- int8이 바이트이다. 이거 왜 계속 까먹는지..
---

## 📗 비고
- 드림핵 질문에 41과 43이 만약 원래 mp3에 있을때를 어떻게 해야할까를 올렸다. 만약 40과 42가 변조되지 않은 값이라는걸 확정하면 편한데.. 
