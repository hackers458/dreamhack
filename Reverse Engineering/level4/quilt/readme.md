# 🧩 Reverse Engineering Challenge: quilt

## 📖 문제 개요
- **문제 이름**: quilt 
- **출처**: 드림핵  
- **키워드**: base64 & bmp  
- **설명**: bmp의 구조와 bmp의 픽셀을 이루는 파일을 역분석하여 입력해야하는 플래그를 얻어야 하는 문제

---

## 🛠️ 사용 도구
- **IDA**: 정적 분석  
- **GDB**: 동적 분석  
- **PyCharm**: 코드 작성  

---

## 🚀 풀이 방법
- 1. bmp의 구조를 이해 한 뒤 화소를 다시 base64 형태로 만들어 base64 -> 원래 문자로 만든 뒤 플래그를 찾는다.

---

## 📁 파일 구성
- **quilt** : bmp이미지에 플래그를 입혀주는 프로그램
- **quilt.bmp** : 플래그가 숨겨진 bmp이미지, 총 16x16이미지로 되어있다.

---

## 🔍 파일 동작 원리
**좀 복잡하니 신중하게 적었습니다** 


| 단계 | 이미지 | 설명 |
|------|--------|------|
| Step 1 | <img width="626" height="888" alt="화면 캡처 2026-02-17 004838" src="https://github.com/user-attachments/assets/64e29563-0958-4fea-a83d-63c5ed322203" />| 1번은 bmp의 헤더 관련 값들이다. 각 인덱스에 해당하는 값의 의미들은 notion에 적어놓았으므로 생략,2번이 중요한데, random값 x과 y[192]를 뽑아 strncpy에서 랜덤 y로 이루어진 192에서 x%(192-플래그위치)인 곳에 플래그를 삽입한다.<br>그 후 base64 함수에서 입력한 192의 길이의 문자열을 6비트로 끊어 새로운 256의 문자열을 만든다. 그리고 base64의 결과와 bmp파일,그리고 off_6을 전달한다(off_6은 구조체이다)|
| Step 2 |<img width="777" height="881" alt="화면 캡처 2026-02-17 005635" src="https://github.com/user-attachments/assets/25514d6f-bc47-4179-ba24-83e52776f182" />|bmp 사진을 보면 사각형이 16x16으로 되어있다. 이는 1번과 2번을 16x16으로 구현한것이다. 3번과 4번은 화소를 32x32의 사각형을 만드는 것이다. 특이점은 base64[0~255]까지는 순서대로이나 3번위의 j & 1 !=0을 보아 사각형을 스네이크 형식으로 저장한다는것이다. 원래는 hxd의 bmp 헤더부터 쭉 내려갈때 이미지의 생성은 이미지의 맨 왼쪽 맨 아래부터 맨 오른쪽, 그리고 다시 한칸 위로 올라가 반대로 간다.|
| 참고사진 |<img width="1682" height="1097" alt="화면 캡처 2026-02-17 012059" src="https://github.com/user-attachments/assets/60e4fd7e-511d-4063-b325-925e35fcb2ff" />|즉 한블럭당 32x32를 한줄한줄 32개씩 채워 블록 16개를 다 채운 다음 그 다음 층으로 가 왼쪽에서 오른쪽으로 채우지만! 다시 구할려면 아까 j의 짝수 홀수의 유무에 따라 그 층의 16개의 위치들을 뒤집어야 한다.(1...16이면 16...1)로 그리고 나서 v16의 끝부분부터 0까지 저장한다.|




---

## 🧠 접근 방법
**크게 나누면 이렇다.
맨 아래층 아래 왼쪽에서부터 오른쪽 끝까지의 rgb를 구한 뒤 이 rgb의 저장소인 byte_2020[64][3]를 통해 해당하는 인덱스를 구한다.중요한 부분은 그 다음층은 짝수층이기에 인덱스를 뒤집어야 한다.
예를 들어 맨 층에서부터 위로 구한 인덱스가 아래처럼
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16
17 18 ... 20이면
17.. 20을 20..17로 뒤집어 준 뒤
이 숫자들을 다 이어준다.1234567....끝까지
그 후 각 숫자들을 2진수로 나타낸 뒤 8비트씩 묶어서 1바이트당 출력하면 플래그가 나온다.



---

## 😪 막힌 부분
- j & 1 !=0 부분을 안봐서 왜 이상하게 나왔다 싶었다..
- 배열을 동적할당하는데 이게 좀 어려웟다.

---

## 📚 공부한 내용
- **bmp** 파일 구조에 대해 알게되었다.

---


